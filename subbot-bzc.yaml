openapi: 3.0.0
info:
  title: Subbot Apple API
  version: '1.0'

components:
  schemas:
    ##################################################
    # Apple Messages for Business objects
    ##################################################
    AppleLocale:
      description: The user's device locale settings as an ISO locale code. XXX. Fill valid values in enum below
      type: string
      enum:
        - fr_FR
        - en_UK

    AppleCountryCode:
      description: a two-letter ISO 3166 country code. XXX. Fill valid values in enum below
      type: string

    AppleCurrencyCode:
      description:  a three-letter ISO 4217 currency code. XXX. Fill valid values in enum below
      type: string

    AppleAttachment:
      type: object
      properties:
        name:
          description: the name of the file created by the user.
          type: string
        file-size:
          description: the size of the attachment in bytes.
          type: number
        mime-type:
          description: mime type of the attachment.
          type: string
        url:
          description: url where the attachment can be downloaded. This url is short-lived.
          type: string
          format: uri

    Apple_Text_Event:
      title: Text Event
      description: >
        A message of type [Text](https://register.apple.com/resources/messages/msp-rest-api/type-text)
      type: object
      properties:
        type:
          type: string
          enum: [text]
        locale:
          $ref: '#/components/schemas/AppleLocale'
        body:
          description: The text of the message sent by the user
          type: string
#        attachments:
#          description: The list of attachments associated with this message
#          type: array
#          items:
#            $ref: '#/components/schemas/AppleAttachment'
#        group:
#          description: [Group](https://register.apple.com/resources/messages/messaging-documentation/message-with-customers) field
#          type: string
#        intent:
#          description: [Intent](https://register.apple.com/resources/messages/messaging-documentation/message-with-customers) field
#          type: string
        capability-list:
          description: The list of the user's device capabilities.
          type: array
          items:
            type: string
            enum: [quick, list, time, auth, auth2, form]
      required:
        - type
        - locale
        - body


    AppleInteractiveEvent:
      type: object
      properties:
        type:
          type: string
          enum: [interactive]
        locale:
          $ref: '#/components/schemas/AppleLocale'
        interactiveData:
          type: object
          properties:
            bid:
              type: string
              enum:
                - com.apple.messages.MSMessageExtensionBalloonPlugin:0000000000:com.apple.icloud.apps.messages.business.extension
            data:
              type: object
              properties:
                requestIdentifier:
                  type: string
                images:
                  $ref: '#/components/schemas/AppleInteractiveImages'
              required:
                - requestIdentifier
                - version
          required:
            - bid
            - data
      required:
        - type
        - interactive

    AppleInteractiveEventv1:
      allOf:
        - $ref: '#/components/schemas/AppleInteractiveEvent'
        - type: object
          properties:
            interactiveData:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    version:
                      type: string
                      enum: [1.0]
      
    AppleInteractiveEventv2:
      allOf:
        - $ref: '#/components/schemas/AppleInteractiveEvent'
        - type: object
          properties:
            interactiveData:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    version:
                      type: string
                      enum: [2.0]
      

    Apple_Quick_Reply_Event:
      title: Quick Reply Event
      allOf:
        - $ref: '#/components/schemas/AppleInteractiveEventv1'
        - type: object
          description: a [QuickReply](https://register.apple.com/resources/messages/msp-rest-api/type-interactive#quick-reply-webhook-event) event
          properties:
            interactiveData:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    selectedIndex:
                      description: The selected item number from top order.
                      type: integer
                    selectedIdentifier:
                      description: The selected identifier of the item.
                      type: string
                    items:
                      $ref: '#/components/schemas/Apple_Quick_Reply_Items'
                  required:
                    - selectedIndex
                    - selectedIdentifier
                    - items

    AppleListPickerSection:
      type: object
      properties:
        title:
          type: string
        order:
          type: integer
        multipleSelection:
          type: boolean
          default: false
        listPickerItem:
          type: array
          items:
            type: object
            properties:
              title:
                type: string
              identifier:
                type: string
              subtitle:
                type: string
              order:
                type: integer
              imageIdentifier:
                type: string
              style:
                $ref: '#/components/schemas/AppleStyle'
            required:
              - identifier
              - title
      required:
        - title

    Apple_List_Picker_Event:
      title: List Picker Event
      allOf:
        - $ref: '#/components/schemas/AppleInteractiveEventv1'
        - type: object
          properties:
            interactiveData:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    listPicker:
                      type: object
                      properties:
                        sections:
                          type: array
                          items:
                            allOf:
                              - description: >
                                  The first element in this array contains the items selected by the user.
                                  The second element in this array
#                                type: array
#                                minItems: 2
#                                maxItems: 2
                              - $ref: '#/components/schemas/AppleListPickerSection'
                      required:
                        - sections
                  required:
                    - listPicker
      
    Apple_Time_Picker_Event:
      title: Time Picker Event
      allOf:
        - $ref: '#/components/schemas/AppleInteractiveEventv1'
        - description: A time slot chosen by the user.
        - type: object
          properties:
            interactiveData:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    event:
                      type: object
                      properties:
                        identifier:
                          description: The selected identifier of the time slot.
                          type: string
                        timezoneOffset:
                          type: integer
                        timeslots:
                          type: array
                          description: A single-item list containing the time slot selected by the user
                          items:
                            $ref: '#/components/schemas/Apple_Timeslot'
                        title:
                          type: string
                        imageIdentifier:
                          type: string
                        location:
                          $ref: '#/components/schemas/Apple_Location'
                    replyMessage:
                      $ref: '#/components/schemas/AppleReplyMessage'

    Apple_Form_Event:
      title: Form Event
      allOf:
        - $ref: '#/components/schemas/AppleInteractiveEventv1'
        - description: a user's [response](https://register.apple.com/resources/messages/msp-rest-api/type-interactive#response-payload) to a form.
          type: object
          properties:
            interactiveData:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    dynamic:
                      type: object
                      properties:
                        selections:
                          type: object
                          properties:
                            pageIdentifier:
                              type: string
                            title:
                              type: string
                            subtitle:
                              type: string
                            items:
                              type: array
                              items:
                                type: object
                                properties:
                                  identifier:
                                    type: string
                                  type:
                                    type: string
                                    enum: [select, datePicker, input]
                                  title:
                                    type: string
                                  value:
                                    type: string
                      required:
                        - selections
                  required:
                    - dynamic
              required:
                - data
          required:
            - interactiveData

    Apple_Authentication_Event:
      title: Authentication Event
      allOf:
        - $ref: '#/components/schemas/AppleInteractiveEventv1'
        - type: object
          properties:
            interactiveData:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    authenticate:
                      type: object
                      properties:
                        token:
                          type: string
                          description: A Base64-encoded authentication token string, which is encrypted with the responseEncryptionKey from the request when authentication is successful.
                        status:
                          type: string
                        errors:
                          type: array
                          items:
                            type: object
                            properties:
                              code:
                                description: A numerical error code. 
                                type: integer
                                enum: [1, 2, 3]
                              domain:
                                type: string
                                enum: ['com.apple.icloud.messages.business.cryptor']
                                description: A string indicating the error domain. XXX. Missing description of values (at least, 2. cryptor vs authentication)
                              message:
                                type: string
                                description: A string indicating the description of the error. XXX. Missing description of values
                      required:
                        - status
                        - errors
      
  
    Apple_New_Authentication_Event:
      title: New Authentication Event
      allOf:
        - $ref: '#/components/schemas/AppleInteractiveEventv2'
        - type: object
          properties:
            interactiveData:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    authenticate:
                      type: object
                      properties:
                        status:
                          type: string
                          enum: [success, failure, cancel, unknown]
                        error_code:
                          type: string
                      required:
                        - status
                        - error_code

    Apple_Pay_Event:
      title: Apple Pay Event
      allOf:
        - $ref: '#/components/schemas/AppleInteractiveEventv2'
        - type: object
          description: This format is not documented. XXX. The following is completely guessed
          properties:
            interactiveData:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    payment:
                      type: object
                      properties:
                        status:
                          type: string
    
      
  

    Apple_Event:
      title: Apple Business Chat Event
      description: >
        A message sent by a user to a brand.
      oneOf:
        - $ref: '#/components/schemas/Apple_Text_Event'
        - $ref: '#/components/schemas/Apple_Quick_Reply_Event'
        - $ref: '#/components/schemas/Apple_List_Picker_Event'
        - $ref: '#/components/schemas/Apple_Time_Picker_Event'
        - $ref: '#/components/schemas/Apple_Form_Event'
        - $ref: '#/components/schemas/Apple_Authentication_Event'
        - $ref: '#/components/schemas/Apple_New_Authentication_Event'
        - $ref: '#/components/schemas/Apple_Pay_Event'

    Apple_Text_Message:
      title: Text Message
      description: A text message
      type: object
      properties:
        type:
          type: string
          enum: [text]
        body:
          description: The text message to send
          type: string
        attachments:
          description: The optional attachments. There should be one \uFFFC in the message text body for each entry in this array.
          type: array
          items:
            $ref: '#/components/schemas/AppleAttachment'
      required:
        - type
        - body

    AppleVideoAsset:
      description: A video asset for rich links
      type: object
      properties:
        mimeType:
          type: string
          enum: [video/mp4]
        url:
          description: a url to the video data
          type: string
          format: uri
      required:
        - mimeType
        - url

    AppleImageAsset:
      description: An image asset for rich links
      type: object
      properties:
        mimeType:
          type: string
          enum: [image/png, image/jpeg]
        data:
          description: a base64 encoded string representing the image bytes
          type: string
      required:
        - mimeType
        - data
  

    Apple_Rich_Link_Message:
      title: Rich Link Message
      description: >
        A [richLink](https://register.apple.com/resources/messages/msp-rest-api/type-richlink#rich-link-messages) message
      type: object
      properties:
        type:
          type: string
          enum: [richLink]
        body:
          description: The link to send
          type: string
          format: uri
        richLinkData:
          type: object
          properties:
            url:
              type: string
              format: uri
            title:
              type: string
            assets:
              type: object
              properties:
                image:
                  $ref: '#/components/schemas/AppleImageAsset'
                video:
                  $ref: '#/components/schemas/AppleVideoAsset'
          required:
            - url
            - title
            - assets
            
      required:
        - type
        - body
        - richLinkData

    AppleStyle:
      type: string
      description: >
        A style that controls the size of the view rendered by Live Layout. 
        The default is icon.
      enum: [icon, small, large]

    AppleInteractiveResponse:
      description: an [InteractiveResponse](https://register.apple.com/resources/messages/msp-rest-api/type-interactive#InteractiveResponse) object
      type: object
      properties:
        title:
          description: >
            The main title that Messages shows in the header of the reply message bubble.
            When the user taps the reply message bubble, Messages replaces the title with 
            the user’s selection. Limited to 512 characters.
          type: string
          maxLength: 512
        subTitle:
          description: >
            The subtitle that appears under the main title in the reply message bubble.
            When the user taps the reply message bubble, Messages displays the subtitle 
            in the header. Limited to 512 characters. 
          type: string
          maxLength: 512
        secondarySubtitle:
          description: >
            A right-aligned title. Limited to 512 characters. Only custom interactive messages use this key.
          type: string
          maxLength: 512
        tertiarySubtitle:
          description: >
            A right-aligned title. Limited to 512 characters. Only custom interactive messages use this key.
          type: string
          maxLength: 512
        imageTitle:
          description: >
            The attached image's title. Limited to 512 characters. Only custom interactive messages use this key.
          type: string
          maxLength: 512
        imageSubtitle:
          description: >
            The attached image's subtitle. Limited to 512 characters. Only custom interactive messages use this key.
          type: string
          maxLength: 512
        style:
          $ref: '#/components/schemas/AppleStyle'
      required:
        - title

    AppleReplyMessage:
      description: a [ReplyMessage](https://register.apple.com/resources/messages/msp-rest-api/type-interactive#replyMessage) message
      type: object
      properties:
        title:
          type: string
          description: >
            The main title that the Messages app shows in the header of the reply message bubble.
            When the user taps the reply message bubble, the Messages app replaces the title 
            with the user’s selection. Limited to 512 characters.
          maxLength: 512
        subtitle:
          type: string
          description: >
            The subtitle that appears under the main title in the reply message bubble.
            When the user taps the reply message bubble, the Messages app displays the subtitle 
            in the header. Limited to 512 characters.
          maxLength: 512
        imageTitle:
          type: string
          description: The attached image's title. Limited to 512 characters. Only custom interactive messages use this key.
          maxLength: 512
        imageSubtitle:
          type: string
          description: The attached image's subtitle. Limited to 512 characters. Only custom interactive messages use this key.
          maxLength: 512
        secondarySubtitle:
          type: string
          description: A right-aligned title. Limited to 512 characters. Only custom interactive messages use this key.
          maxLength: 512
        tertiarySubtitle:
          type: string
          description: A right-aligned subtitle. Limited to 512 characters. Only custom interactive messages use this key.
          maxLength: 512
        imageIdentifier:
          type: string
          description: The identifier for one of the images specified in interactiveData.data.images.
        style:
          $ref: '#/components/schemas/AppleStyle'

    AppleReceivedMessage:
      allOf:
        - $ref: '#/components/schemas/AppleInteractiveResponse'
        - type: object
          properties:
            imageIdentifier:
              type: string
          required:
            - imageIdentifier

    AppleInteractiveImages:
      type: array
      items:
        description: an [ImageItem](https://register.apple.com/resources/messages/msp-rest-api/type-interactive#ImageItem) in interactiveData.data.images
        type: object
        properties:
          data:
            description: A Base64-encoded string representing the image file data. Always provide @3x images at 72 dpi. 
            type: string
            format: byte
          description:
            description: Description of the image that the systems reads aloud to users who have VoiceOver enabled on their device.
            type: string
          identifier:
            type: string
            description: A string containing the image identifier, which must be unique within the list of images.
        required:
          - data
          - identifier

    Apple_New_Authentication_Message:
      title: New Authentication Message
      description: A [New Authentication](https://register.apple.com/resources/messages/msp-rest-api/new-oauth) message
      type: object
      properties:
        type:
          type: string
          enum: [interactive]
        locale:
          $ref: '#/components/schemas/AppleLocale'
        interactiveData:
          type: object
          properties:
            bid:
              type: string
              enum:
                - com.apple.messages.MSMessageExtensionBalloonPlugin:0000000000:com.apple.icloud.apps.messages.business.extension
            data:
              type: object
              properties:
                version:
                  type: string
                  enum: [2.0]
                requestIdentifier:
                  type: string
                  format: uuid
                images:
                  $ref: '#/components/schemas/AppleInteractiveImages'
                authenticate:
                  type: object
                  properties:
                    oauth2:
                      type: object
                      properties:
                        redirectURI:
                          type: string
                          format: uri
                        responseType:
                          type: string
                          enum: [code]
                        scope:
                          type: array
                          items:
                            type: string
                        state:
                          type: string
                      required:
                        - scope
                        - state
                        - redirectURI
                        - responseType
                  required:
                    - oauth2
              required:
                - version
                - requestIdentifier
                - authenticate
            receivedMessage:
              $ref: '#/components/schemas/AppleReceivedMessage'
            replyMessage:
              $ref: '#/components/schemas/AppleReplyMessage'
          required:
            - bid
            - data
            - receivedMessage
            - replyMessage
      required:
        - type
        - interactiveData

    Apple_Quick_Reply_Items:
      type: array
      maxLength: 5
      items:
        type: object
        properties:
          identifier:
            type: string
            description: An identifier to identify the item.
          title:
            type: string
            description: Title of the quick reply item. Max 1 line of text.

    AppleBasicInteractiveMessage:
      type: object
      properties:
        type:
          type: string
          enum: [interactive]
        interactiveData:
          type: object
          properties:
            bid:
              type: string
              enum:
                - com.apple.messages.MSMessageExtensionBalloonPlugin:0000000000:com.apple.icloud.apps.messages.business.extension
            data:
              type: object
              properties:
                version:
                  type: string
                  enum: ['1.0']
                requestIdentifier:
                  type: string
              required:
                - version
                - requestIdentifier
          required:
            - bid
            - data
      required:
        - type
        - interactiveData

    AppleInteractiveMessage:
      allOf:
        - $ref: '#/components/schemas/AppleBasicInteractiveMessage'
        - type: object
          properties:
            interactiveData:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    images:
                      $ref: '#/components/schemas/AppleInteractiveImages'
                receivedMessage:
                  $ref: '#/components/schemas/AppleReceivedMessage'
                replyMessage:
                  $ref: '#/components/schemas/AppleReplyMessage'
              required:
                - receivedMessage
                - replyMessage
        

    Apple_Quick_Reply_Message:
      title: Quick Reply Message
      allOf:
        - $ref: '#/components/schemas/AppleBasicInteractiveMessage'
        - description: a [QuickReply](https://register.apple.com/resources/messages/msp-rest-api/type-interactive#quick-reply-message) message
          type: object
          properties:
            interactiveData:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    quick-reply:
                      type: array
                      items:
                        type: object
                        properties:
                          summaryText:
                            type: string
                            description: A summary text that will be used for device notification but also shown in the transcript after user makes a choice.
                          items:
                            $ref: '#/components/schemas/Apple_Quick_Reply_Items'
                  required:
                    - quick-reply

    Apple_List_Picker_Message:
      title: List Picker Message
      allOf:
        - $ref: '#/components/schemas/AppleInteractiveMessage'
        - type: object
          description: a [ListPicker](https://register.apple.com/resources/messages/msp-rest-api/type-interactive#list-picker-message) message
          properties:
            interactiveData:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    listPicker:
                      type: object
                      properties:
                        sections:
                          type: array
                          items:
                            $ref: '#/components/schemas/AppleListPickerSection'
                      required:
                        - sections
                  required:
                    - listPicker

    Apple_Location:
      type: object
      properties:
        title:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        radius:
          type: number

    Apple_Timeslot:
      type: object
      properties:
        duration:
          type: integer
        identifier:
          type: string
        startTime:
          description: A UTC date string, represented by a valid date in ISO-8601 format and specified as absolute GMT +0000 date
          type: string
          format: date-time
      required:
        - duration
        - identifier
        - startTime

    Apple_Time_Picker_Message:
      title: Time Picker Message
      allOf:
        - $ref: '#/components/schemas/AppleInteractiveMessage'
        - type: object
          description: a [TimePicker](https://register.apple.com/resources/messages/msp-rest-api/type-interactive#time-picker-message) message
          properties:
            interactiveData:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    event:
                      type: object
                      properties:
                        identifier:
                          type: string
                        imageIdentifier:
                          type: string
                        location:
                          $ref: '#/components/schemas/Apple_Location'
                        timeslots:
                          type: array
                          items:
                            $ref: '#/components/schemas/Apple_Timeslot'
                        timezoneOffset:
                          type: integer
                        title:
                          type: string
                      required:
                        - identifier
                  required:
                    - event

    Apple_iMessage_App_Message:
      title: iMessage App Message
      description: an [iMessage App](https://register.apple.com/resources/messages/msp-rest-api/type-interactive#imessage-app) message
      type: object
      properties:
        type:
          type: string
          enum: [interactive]
        interactiveData:
          type: object
          properties:
            bid:
              description: a bid that references your apple extension.
              type: string
              enum:
                - com.apple.messages.MSMessageExtensionBalloonPlugin:{team-id}:{ext-bundle-id}
            receivedMessage:
              $ref: '#/components/schemas/AppleReceivedMessage'
            replyMessage:
              $ref: '#/components/schemas/AppleReplyMessage'
            appIcon:
              type: string
              format: byte
              description: A Base64-encoded string representing the app icon of the iMessage app.
            appId:
              type: string
              description:  The App Store identifier of the iMessage app.
            appName:
              type: string
              description: The name of the iMessage app.
            URL:
              type: string
              format: uri
              description: A URL string containing data that the Messages app sends to the iMessage app.
            useLiveLayout:
              type: boolean
              default: true
              description: A Boolean that determines whether the Messages app should use Live Layout. 
          required:
            - bid
            - receivedMessage
            - replyMessage
            - appIcon
            - appId
            - appName
            - URL
            - useLiveLayout
      required:
        - type
        - interactiveData

    Apple_Form_Page:
      type: object
      properties:
        pageIdentifier:
          type: string
        title:
          type: string
        subtitle:
          type: string
        nextPageIdentifier:
          type: string
        submitForm:
          type: boolean
          description: XXX Required or not ?
      required:
        - pageIdentifier
        - type
        - subtitle
        - nextPageIdentifier

    Apple_Form_Select_Page:
      allOf:
        - $ref: '#/components/schemas/Apple_Form_Page'
        - type: object
          properties:
            type:
              type: string
              enum: [select]
            multipleSelection:
              type: boolean
              default: false
            items:
              type: array
              items:
                type: object
                properties:
                  title:
                    type: string
                  value:
                    type: string
                  identifier:
                    type: string
                  imageIdentifier:
                    type: string
                  nextPageIdentifier:
                    type: string
                required:
                  - identifier
          required:
            - type
            - items

    Apple_Form_Picker_Page:
      allOf:
        - $ref: '#/components/schemas/Apple_Form_Page'
        - type: object
          properties:
            type:
              type: string
              enum: [picker]
            pickerTitle:
              type: string
              default: ""
            selectedItemIndex:
              type: integer
              default: 0
            items:
              type: array
              items:
                type: object
                properties:
                  identifier:
                    type: string
                  title:
                    type: string
                  value:
                    type: string
                required:
                  - identifier
          required:
            - type
            - items

    Apple_Form_Date_Picker_Page:
      allOf:
        - $ref: '#/components/schemas/Apple_Form_Page'
        - type: object
          properties:
            type:
              type: string
              enum: [datePicker]
            hintText:
              type: string
            options:
              type: object
              properties:
                dateFormat:
                  type: string
                  default: MM/dd/yyyy
                startDate:
                  type: string
                minimumDate:
                  type: string
                maximumDate:
                  type: string
                labelText:
                  type: string
                  default: Date
              required:
                - identifier
          required:
            - type

    Apple_Form_Input_Page:
      allOf:
        - $ref: '#/components/schemas/Apple_Form_Page'
        - type: object
          properties:
            type:
              type: string
              enum: [input]
            hintText:
              type: string
            options:
              type: object
              properties:
                regex:
                  type: string
                placeholder:
                  type: string
                required:
                  type: boolean
                  default: false
                inputType:
                  type: string
                  enum: [singleline, multiline]
                labelText:
                  type: string
                prefixText:
                  type: string
                maximumCharacterCount:
                  type: integer
                keyboardType:
                  type: string
                  enum: [default, asciiCapable, numbersAndPunctuation, URL, numberPad, phonePad, namePhonePad, emailAddress, decimalPad, UIKeyboardTypeTwitter, webSearch]
                textContentType:
                  type: string
                  enum: [name, namePrefix, givenName, middleName, familyName, nameSuffix, nickname, jobTitle, organizationName, location, fullStreetAddress, streetAddressLine1, streetAddressLine2, addressCity, addressState, addressCityAndState, sublocality, countryName, postalCode, telephoneNumber, emailAddress, URL, creditCardNumber, username, password, newPassword, oneTimeCode]
          required:
            - type

    Apple_Form_Data:
      type: object
      properties:
        splash:
          type: object
          properties:
            header:
              type: string
            splashText:
              type: string
            buttonTitle:
              type: string
            imageIdentifier:
              type: string
          required:
           - buttonTitle
        startPageIdentifier:
          type: string
        private:
          type: boolean
          default: false
        showSummary:
          type: boolean
          default: false
        pages:
          type: array
          items:
            oneOf:
              - $ref: '#/components/schemas/Apple_Form_Select_Page'
              - $ref: '#/components/schemas/Apple_Form_Picker_Page'
              - $ref: '#/components/schemas/Apple_Form_Date_Picker_Page'
              - $ref: '#/components/schemas/Apple_Form_Input_Page'
      required:
        - startPageIdentifier

    Apple_Dynamic:
      type: object
      properties:
        version:
          type: string
          enum: [1.1]
        template:
          type: string
          enum: [messageForms]
        data:
          $ref: '#/components/schemas/Apple_Form_Data'
      required:
        - version
        - template
        - data

    Apple_Form_Message:
      title: Form Message
      allOf:
        - $ref: '#/components/schemas/AppleInteractiveMessage'
        - type: object
          description: a [Form](https://register.apple.com/resources/messages/msp-rest-api/type-interactive#form-message) message
          properties:
            interactiveData:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    dynamic:
                      $ref: '#/components/schemas/Apple_Dynamic'
                  required:
                    - dynamic

    Apple_Authentication_Message:
      title: Authentication Message
      allOf:
        - $ref: '#/components/schemas/AppleInteractiveMessage'
        - type: object
          description: an [authentication message](https://register.apple.com/resources/messages/msp-rest-api/type-interactive#authentication-message).
          properties:
            interactiveData:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    authenticate:
                      type: object
                      properties:
                        oauth2:
                          type: object
                          properties:
                            clientSecret:
                              type: string
                              description: A string indicating the secret provisioned by the authorization server.
                            responseEncryptionKey:
                              type: string
                              description: A string indicating the Base64-encoded public key that encrypts the access token returned in the response.
                            responseType:
                              type: string
                              enum: [code]
                              description: A string indicating the type of authentication request.
                            scope:
                              type: array
                              description: An array of scope items that specifies the scope of the request.This dictionary entry gives the exact fields of data that the authentication service provides to the client requesting the authentication.
                              items:
                                type: string
                            state:
                              type: string
                              description: A string indicating the state of the authentication request.
                          required: [responseType, scope, state, responseEncryptionKey, clientSecret]
                      required: [oauth2]
                  required: [authenticate]

    ApplePayEndpoints:
      type: object
      properties:
        paymentGatewayUrl:
          type: string
          format: uri
          description: Called by Apple Pay to process the payment through the payment provider. The URL should match the URL in the initiativeContext field of the payment session.
        fallbackUrl:
          type: string
          format: uri
          description: A URL that opens in a web browser so the customer can complete the purchase if their device is unable to make payments using Apple Pay.
        orderTrackingUrl:
          type: string
          format: uri
          description: Called by Messages for Business after completing the order; provides you with an opportunity to update the order information in your system.
        paymentMethodUpdateUrl:
          type: string
          format: uri
          description: Called by Apple Pay when the customer changes the payment method. If you don’t implement this endpoint and you include this key in the dictionary, the customer sees an error message.
        shippingContactUpdateUrl:
          type: string
          format: uri
          description: Called by Apple Pay when the customer changes their shipping address information. If you don’t implement this endpoint and you include this key in the dictionary, the customer sees an error message.
        shippingMethodUpdateUrl:
          type: string
          format: uri
          description: Called by Apple Pay when the customer changes the shipping method. If you don’t implement this endpoint and you include this key in the dictionary, the customer sees an error message.
      required: [paymentGatewayUrl]

    ApplePayMerchantSession:
      type: object
      properties:
        displayName:
          type: string
          description: The canonical name for your store, suitable for display and consisting of 64 or fewer UTF-8 characters. Do not localize the name.
        epochTimestamp:
          type: string
          description: The time representation in number of seconds that have elapsed since 00:00:00 UTC, Thursday, January 1, 1970.
        expiresAt:
          type: string
          description: The expiration time representation in number of seconds that have elapsed since 00:00:00 UTC, Thursday, January 1, 1970.
        initiative:
          type: string
          description: A predefined value that identifies the e-commerce application making the request.
          enum: [messaging]
        initiativeContext:
          type: string
          format: uri
          description: Your payment gateway URL. 
        merchantIdentifier:
          type: string
          description: A unique identifier that represents a merchant for Apple Pay.
        merchantSessionIdentifier:
          type: string
          description: A unique identifier that represents a merchant's session for Apple Pay.
        nonce:
          type: string
          format: byte
          description: XXX. The type of this field is currently undocumented and unknown
        signature:
          type: string
          format: byte
          description: XXX. The type of this field is currently undocumented and unknown
      required: [displayName, epochTimestamp, expiresAt, initiative, initiativeContext, merchantIdentifier, merchantSessionIdentifier]


    AppleContactFields:
      description: a list of [contact field](https://developer.apple.com/documentation/apple_pay_on_the_web/applepaycontactfield)
      type: array
      items:
        type: string
        enum: [email, name, phone, postalAddress, phoneticName]


    ApplePayDateComponent:
      description: a [DateComponents](https://developer.apple.com/documentation/apple_pay_on_the_web/applepaydatecomponents)
      type: object
      properties:
        years:
          type: integer
        months:
          type: integer
        days:
          type: integer
        hours:
          type: integer


    ApplePayShippingMethod:
      type: object
      properties:
        label:
          type: string
        detail:
          type: string
        amount:
          type: string
        identifier:
          type: string
        dateComponentsRange:
          type: object
          properties:
            startDateComponents:
              $ref: '#/components/schemas/ApplePayDateComponent'
            endDateComponents:
              $ref: '#/components/schemas/ApplePayDateComponent'
      required: [label, detail, amount, identifier]

    ApplePayLineItem:
      description: a [Line item](https://developer.apple.com/documentation/apple_pay_on_the_web/applepaylineitem)
      type: object
      properties:
        type:
          type: string
          enum: [final, pending]
        label:
          type: string
        amount:
          type: string
        paymentTiming:
          type: string
          enum: [immediate, recurring, deferred, automaticReload]
        recurringPaymentStartDate:
          type: string
          description: XXX. ubnknown
        recurringPaymentIntervalUnit:
          type: string
          enum: [year, month, day, hour, minute]
        recurringPaymentIntervalCount:
          type: integer
          minimum: 0
        recurringPaymentEndDate:
          type: string
          description: XXX. uinknown
        deferredPaymentDate:
          type: string
          description: XXX. uinknown
        automaticReloadPaymentThresholdAmount:
          type: string

    ApplePayApplePay:
      type: object
      properties:
        merchantCapabilities:
          type: array
          items:
            type: string
            enum: [supports3DS, supportsCredit, supportsDebit, supportsEMV]
        merchantIdentifier:
          type: string
          description: A unique identifier that represents a merchant for Apple Pay.
        supportedNetworks:
          type: string
          enum: [amex, bancomat, bancontact, cartesBancaires, chinaUnionPay, dankort, discover, eftpos, electron, elo, girocard, interac, jcb, mada, maestro, masterCard, mir, privateLabel, visa, vPay]
      required: [merchantIdentifier]


    ApplePayPaymentRequest:
      type: object
      properties:
        applePay:
          $ref: '#/components/schemas/ApplePayApplePay'
        countryCode:
          $ref: '#/components/schemas/AppleCountryCode'
        currencyCode:
          $ref: '#/components/schemas/AppleCurrencyCode'
        lineItems:
          description: An array of line items explaining payments and additional charges.
          type: array
          items:
            $ref: '#/components/schemas/ApplePayLineItem'
        requiredBillingContactFields:
          $ref: '#/components/schemas/AppleContactFields'
        requiredShippingContactFields:
          $ref: '#/components/schemas/AppleContactFields'
        shippingMethods:
          type: array
          items:
            $ref: '#/components/schemas/ApplePayShippingMethod'
        supportedCountries:
          type: array
          items:
            $ref: '#/components/schemas/AppleCountryCode'
        total:
          $ref: '#/components/schemas/ApplePayLineItem'
      required: [applePay, countryCode, currencyCode, lineItems, total]


    Apple_Pay_Message:
      title: Apple Pay Message
      allOf:
        - $ref: '#/components/schemas/AppleInteractiveMessage'
        - type: object
          description: an [apple pay message](https://register.apple.com/resources/messages/msp-rest-api/type-interactive#apple-pay-message)
          properties:
            interactiveData:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    payment:
                      type: object
                      properties:
                        endpoints:
                          $ref: '#/components/schemas/ApplePayEndpoints'
                        merchantSession:
                          $ref: '#/components/schemas/ApplePayMerchantSession'
                        paymentRequest:
                          $ref: '#/components/schemas/ApplePayPaymentRequest'
                      required: [endpoints, merchantSession, paymentRequest]
                  required: [payment]



    Apple_Message:
      title: Apple Business Chat Message
      description: A message sent by a brand to a user.
      oneOf:
        - $ref: '#/components/schemas/Apple_Text_Message'
        - $ref: '#/components/schemas/Apple_Rich_Link_Message'
        - $ref: '#/components/schemas/Apple_Quick_Reply_Message'
        - $ref: '#/components/schemas/Apple_List_Picker_Message'
        - $ref: '#/components/schemas/Apple_Time_Picker_Message'
        - $ref: '#/components/schemas/Apple_iMessage_App_Message'
        - $ref: '#/components/schemas/Apple_Form_Message'
        - $ref: '#/components/schemas/Apple_Authentication_Message'
        - $ref: '#/components/schemas/Apple_New_Authentication_Message'
        - $ref: '#/components/schemas/Apple_Pay_Message'




openapi: 3.0.0
servers:
  - url: https://api.alcmeon.com
    description: Alcmeon production API server

info:
  title: Core API
  version: '1.0'

x-readme:
  explorer-enabled: true

components:
  securitySchemes:
    basic_auth:
      $ref: 'shared-security.yaml#/components/securitySchemes/basic_auth'
    bearer_token:
      $ref: 'shared-security.yaml#/components/securitySchemes/bearer_token'

  schemas:
    ResponseError:
      type: object
      properties:
        error:
          type: string
          description: A short string explaining the reason of the error.
        details:
          type: string
          description: >
            A short string which describes what is wrong. Provide this string to
            support@alcmeon.com if you wish to obtain more details about the problem.

    RateLimitResponseError:
      type: object
      properties:
        error:
          type: string
          description: Rate limit reached
        details:
          type: string
          description: >
            A string showing the time when the rate limit will be reset. Example:
            {'rate_limited_until': '2024-01-22T13:05:41Z'}
    Account:
      type: object
      properties:
        id:
          type: integer
          description: The ID of the account.
          example: 1
        name:
          type: string
          description: The name of the account.
          example: "Facebook test page"
        type:
          type: string
          description: The type of the account.
          example: "facebook"
          enum:
            - "twitter"
            - "facebook"
            - "instagram"
            - "wechat"
            - "gmb"
            - "whatsapp"
            - "bzc"
            - "trustpilot"
            - "inmessage"
            - "line"
            - "kakaotalk"
            - "linkedin"
            - "tiktok"
        enabled:
          type: boolean
          description: Indicates if the account is enabled.
          example: true
        created_at:
          type: string
          format: date-time
          description: The creation date of the account.
          example: "2025-02-17T09:09:58"
        group_id:
          type: integer
          description: The ID of the account group.
          example: 10
    GlobalVariable:
      type: object
      description: A global scenario variable with its name and value
      properties:
        name:
          type: string
          description: The name/key of the global variable
          example: "max_retries"
        value:
          description: The value of the global variable (can be any JSON-serializable type)
          oneOf:
            - type: string
            - type: integer
            - type: number
            - type: boolean
            - type: object
            - type: array
          example: 3
      required:
        - name
        - value

    SetGlobalVariableRequest:
      type: object
      description: Request body for setting a global variable
      properties:
        name:
          type: string
          description: The name/key of the global variable to set
          minLength: 1
          maxLength: 100
          example: "api_timeout"
        value:
          description: The value to set for the global variable (can be any JSON-serializable type)
          oneOf:
            - type: string
            - type: integer
            - type: number
            - type: boolean
            - type: object
            - type: array
          example: 30.5
      required:
        - name
        - value
security:
  - basic_auth: []
  - bearer_token: []

paths:
  /v1/social-accounts/:
    get:
      tags: [Social Accounts]
      summary: Get the list of social accounts
      description: Retrieve a paginated list of social accounts.
      parameters:
        - name: limit
          in: query
          description: The number of social accounts to return per page.
          required: false
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: page
          in: query
          description: The page number to retrieve.
          required: false
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: A list of social accounts.
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Account'
                  next:
                    type: string
                    description: The URL for the next page of results, if available.
        '400':
          description: If the input parameters are not valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseError'
        '429':
          description: Rate limit reached. Default limit is set to 15 requests per minute.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RateLimitResponseError'


  /v1/global-variables:
    get:
      tags: [Global variables]
      summary: Get global scenario variables
      description: Retrieve a paginated list of global scenario variables
      parameters:
        - name: limit
          in: query
          description: Maximum number of variables to return per page
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: page
          in: query
          description: Page number (0-based)
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Successfully retrieved global variables
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/GlobalVariable'
                  next:
                    type: string
                    format: uri
                    description: URL for the next page of results (only present if there are more results)
                    example: "https://api.alcmeon.com/v1/global-variables?limit=20&page=1"
                required:
                  - data
              examples:
                success_with_pagination:
                  summary: Success response with pagination
                  value:
                    data:
                      - name: "max_retries"
                        value: 3
                      - name: "api_timeout"
                        value: 30.5
                      - name: "feature_enabled"
                        value: true
                      - name: "config"
                        value:
                          environment: "production"
                          debug: false
                    next: "https://api.alcmeon.com/v1/global-variables?limit=20&page=1"
                success_without_pagination:
                  summary: Success response without pagination
                  value:
                    data:
                      - name: "welcome_message"
                        value: "Hello, welcome to our service!"
                      - name: "maintenance_mode"
                        value: false
        '400':
          description: Bad request - Invalid pagination parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseError'
              examples:
                invalid_pagination:
                  summary: Invalid pagination parameters
                  value:
                    error: "Invalid pagination parameters"
                    details: "Page must be a non-negative integer"
        '429':
          description: Rate limit reached. Default limit is set to 15 requests per minute.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RateLimitResponseError'

    put:
      tags: [Global variables]
      summary: Set a global scenario variable
      description: Create a new global variable or update an existing one with the given name and value
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetGlobalVariableRequest'
            examples:
              string_value:
                summary: Set a string variable
                value:
                  name: "welcome_message"
                  value: "Hello, welcome to our service!"
              integer_value:
                summary: Set an integer variable
                value:
                  name: "max_retries"
                  value: 3
              float_value:
                summary: Set a float variable
                value:
                  name: "api_timeout"
                  value: 30.5
              boolean_value:
                summary: Set a boolean variable
                value:
                  name: "feature_enabled"
                  value: true
              object_value:
                summary: Set an object variable
                value:
                  name: "config"
                  value:
                    environment: "production"
                    debug: false
                    settings:
                      - "option1"
                      - "option2"
              array_value:
                summary: Set an array variable
                value:
                  name: "allowed_domains"
                  value: ["example.com", "test.com", "demo.com"]
      responses:
        '200':
          description: Successfully set the global variable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GlobalVariable'
              examples:
                created_variable:
                  summary: Successfully created new variable
                  value:
                    name: "new_feature_flag"
                    value: true
                updated_variable:
                  summary: Successfully updated existing variable
                  value:
                    name: "max_retries"
                    value: 5
        '400':
          description: Bad request - Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseError'
              examples:
                missing_name:
                  summary: Missing required name field
                  value:
                    error: "Invalid request body"
                    details: "Missing required field: name"
                missing_value:
                  summary: Missing required value field
                  value:
                    error: "Invalid request body"
                    details: "Missing required field: value"
                invalid_json:
                  summary: Invalid JSON format
                  value:
                    error: "Invalid request body"
                    details: "Invalid JSON format"
        '429':
          description: Rate limit reached. Default limit is set to 15 requests per minute.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RateLimitResponseError'
